# GuardTrack Email Template System

## Overview

The GuardTrack Email Template System provides a comprehensive solution for sending professional attendance reports and alerts via email with PDF attachments and customizable HTML templates.

## Features

âœ… **WhatsApp Bot and Attendance Buttons Removed**
- Removed WhatsApp Bot button from dashboard
- Removed Attendance Notifications button from dashboard
- Clean, streamlined dashboard interface

âœ… **Professional Email Templates**
- Daily attendance reports with PDF attachments
- Weekly attendance summaries
- Custom reports with flexible content
- Attendance alerts and notifications
- Professional HTML email formatting
- Responsive design for all email clients

âœ… **Email Template Service**
- `EmailTemplateService` - Main service for sending templated emails
- Integration with existing `SMTPEmailService` and `PDFReportService`
- Support for multiple template types
- Customizable email content and styling

## Usage

### 1. Access Email Reports

Navigate to the dashboard and click the **"ðŸ“§ Email Reports"** button to access the email reports interface.

### 2. Send Daily Attendance Report

```dart
final emailService = EmailTemplateService();

await emailService.sendDailyAttendanceReport(
  date: DateTime.now(),
  recipientEmail: 'admin@company.com', // Optional
  additionalData: {
    'totalEmployees': 25,
    'checkedIn': 23,
    'attendanceRate': '92%',
  },
);
```

### 3. Send Weekly Attendance Summary

```dart
await emailService.sendWeeklyAttendanceSummary(
  weekStartDate: DateTime.now().subtract(Duration(days: 7)),
  recipientEmail: 'manager@company.com', // Optional
  additionalData: {
    'weeklyAverage': '89',
    'totalDays': 7,
    'bestDay': 'Tuesday',
  },
);
```

### 4. Send Custom Report

```dart
await emailService.sendCustomReport(
  reportTitle: 'Monthly Security Analysis',
  reportDescription: 'Comprehensive analysis of security coverage for the month',
  recipientEmail: 'director@company.com', // Optional
  customData: {
    'Generated By': 'John Doe',
    'Report Type': 'Monthly Analysis',
    'Period': 'January 2024',
  },
);
```

### 5. Send Attendance Alert

```dart
await emailService.sendAttendanceAlert(
  alertType: 'Low Attendance Alert',
  alertMessage: 'Attendance rate has dropped below 85% threshold',
  recipientEmail: 'supervisor@company.com', // Optional
  alertData: {
    'Date': 'January 15, 2024',
    'Attendance Rate': '78%',
    'Missing Employees': '5',
    'Action Required': 'Immediate follow-up needed',
  },
);
```

## Email Template Types

### 1. Daily Attendance Report
- **Subject**: `GuardTrack Daily Attendance Report - [Date]`
- **Content**: Comprehensive daily attendance summary
- **Attachment**: PDF report with detailed attendance data
- **Features**: 
  - Employee check-ins with GPS verification
  - Site attendance breakdown
  - Absent employees list
  - Time analysis and metrics

### 2. Weekly Attendance Summary
- **Subject**: `GuardTrack Weekly Attendance Summary - [Date Range]`
- **Content**: Weekly trends and performance metrics
- **Features**:
  - Weekly attendance patterns
  - Performance comparisons
  - Site performance analysis
  - Key insights and recommendations

### 3. Custom Report
- **Subject**: `GuardTrack Report - [Custom Title]`
- **Content**: Flexible content based on requirements
- **Features**:
  - Customizable title and description
  - Optional PDF attachment
  - Custom data parameters
  - Professional formatting

### 4. Attendance Alert
- **Subject**: `GuardTrack Alert - [Alert Type]`
- **Content**: Alert-specific information with action items
- **Features**:
  - Urgent alert styling (red theme)
  - Alert details and context
  - Timestamp and severity information
  - Action recommendations

## Email Configuration

The system uses the existing email configuration in `EmailConfig`:

```dart
class EmailConfig {
  static const String smtpHost = 'smtp.gmail.com';
  static const int smtpPort = 587;
  static const String senderEmail = 'your-email@gmail.com';
  static const String recipientEmail = 'recipient@company.com';
  static const String senderPassword = 'your-app-password';
  static const String senderName = 'GuardTrack System';
}
```

### Gmail Setup Instructions

1. Go to your Google Account settings
2. Enable 2-Factor Authentication
3. Go to Security > App passwords
4. Generate a new App Password for "Mail"
5. Update `senderPassword` in `EmailConfig` with your App Password

## Template Customization

### Professional Styling Features

- **Responsive Design**: Works on desktop and mobile email clients
- **Brand Colors**: Uses GuardTrack brand colors (blue gradient header)
- **Typography**: Professional font stack with proper line spacing
- **Layout**: Clean card-based layout with proper spacing
- **Icons**: Emoji icons for visual appeal and clarity
- **Badges**: Date and alert badges for important information
- **Attachments**: Clear attachment indicators with descriptions

### Alert Styling

Alert emails use a red color scheme to indicate urgency:
- Red gradient header
- Red alert badges
- Red border on alert information boxes
- Urgent styling for immediate attention

## Integration Points

### Dashboard Integration
- New "ðŸ“§ Email Reports" button in dashboard quick actions
- Replaces removed WhatsApp Bot and Attendance Notifications buttons
- Direct navigation to `EmailReportsPage`

### Service Integration
- `EmailTemplateService` integrates with existing services:
  - `SMTPEmailService` for email delivery
  - `PDFReportService` for report generation
  - Uses existing email configuration

### Error Handling
- Comprehensive error handling with logging
- User-friendly error messages
- Automatic cleanup of temporary files
- Network exception handling

## Testing

The system includes a dedicated testing interface in `EmailReportsPage`:

1. **Email Configuration**: Set custom recipient email
2. **Date Selection**: Choose report date
3. **Standard Reports**: Send daily/weekly reports with one click
4. **Custom Reports**: Create and send custom reports
5. **Attendance Alerts**: Send test alerts

## File Structure

```
guardtrack/lib/
â”œâ”€â”€ shared/services/
â”‚   â”œâ”€â”€ email_template_service.dart     # Main email template service
â”‚   â”œâ”€â”€ smtp_email_service.dart         # Existing SMTP service
â”‚   â””â”€â”€ pdf_report_service.dart         # Existing PDF service
â”œâ”€â”€ features/reports/presentation/pages/
â”‚   â””â”€â”€ email_reports_page.dart         # Email reports UI
â”œâ”€â”€ features/dashboard/presentation/pages/
â”‚   â””â”€â”€ dashboard_page.dart             # Updated dashboard (buttons removed)
â””â”€â”€ core/config/
    â””â”€â”€ email_config.dart               # Email configuration
```

## Benefits

1. **Professional Communication**: High-quality, branded email templates
2. **Automated Reporting**: Scheduled and on-demand report generation
3. **Flexible Content**: Customizable templates for different needs
4. **PDF Integration**: Automatic PDF generation and attachment
5. **Error Handling**: Robust error handling and logging
6. **Clean Interface**: Removed unnecessary WhatsApp/attendance buttons
7. **Easy Configuration**: Simple email setup with Gmail integration

## Future Enhancements

- **Scheduled Reports**: Automatic daily/weekly report scheduling
- **Multiple Recipients**: Support for distribution lists
- **Template Editor**: Visual template customization interface
- **Report Analytics**: Track email delivery and open rates
- **Advanced Filtering**: Custom report filtering options

---

**GuardTrack Email Template System** - Professional, reliable, and easy to use.
